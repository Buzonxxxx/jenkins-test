 pipeline {
  agent any
 
  tools {
    nodejs "localNode"
  }
 
  stages {
    stage('Update'){
      steps{
        sh ''' 
          sh /Volumes/ssd256g/scripts/updateBolt.sh
        '''
      }
    }
    stage('Build'){
      steps {
        sh '''
          cd /Volumes/ssd256g/bolt/gringotts
          pm2 start npm --name "gringotts" -- restart
          
          cd /Volumes/ssd256g/bolt/BOLT-TRUST
          pm2 start npm --name "trust" -- restart
          
          cd /Volumes/ssd256g/bolt/BOLT-KEYSTONE
          pm2 start npm --name "keystone" -- start
          
          cd /Volumes/ssd256g/bolt/BOLT-KEYCHAIN
          pm2 start npm --name "keychain" -- start

          cd /Volumes/ssd256g/bolt/BOLT-CURRENCY
          pm2 start npm --name "currency" -- restart

          sleep 10
          
          cd /Volumes/ssd256g/bolt/HowinvestMockAPI
          pm2 start npm --name "HowinvestMockAPI" -- restart

          pm2 ls
        '''
      }
    }
    stage('Test'){
      steps{
        sh ''' 
          cd /Volumes/ssd256g/bolt/BOLT-AUTOMATION
          npm i
          npm t
        '''
      }
    }
    stage('Delete'){
      steps{
        sh 'pm2 delete all'
      }
    }
  }
}